workflow:
  name: WFM-HR-GetEmployeeBalances
  division: Home
  startUpRef: "/workflow/states/state[Initial State_10]"
  defaultLanguage: en-us
  supportedLanguages:
    en-us:
      none: true
  variables:
    - stringCollectionVariable:
        name: Flow.dates
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringVariable:
        name: Flow.employeeId
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
    - stringCollectionVariable:
        name: Flow.result
        initialValue:
          noValue: true
        isInput: false
        isOutput: true
    - stringVariable:
        name: Flow.timeOffTypeId
        initialValue:
          noValue: true
        isInput: true
        isOutput: false
  settingsErrorHandling:
    errorHandling:
      endWorkflow:
        none: true
  states:
    - state:
        name: Initial State
        refId: Initial State_10
        variables:
          - integerVariable:
              name: State.currentDateIndex
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - integerVariable:
              name: State.datesCount
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringVariable:
              name: State.error
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringVariable:
              name: State.errorCode
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - integerVariable:
              name: State.errorStatus
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringVariable:
              name: State.index
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringVariable:
              name: State.timeOffBalance
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringCollectionVariable:
              name: State.timeOffBalances
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
          - stringCollectionVariable:
              name: State.timeOffTypeIds
              initialValue:
                noValue: true
              isInput: false
              isOutput: false
        actions:
          - updateData:
              name: Update Data
              statements:
                - integer:
                    variable: State.datesCount
                    value:
                      exp: Count(Flow.dates)
          - loop:
              name: Loop
              currentIndex:
                var: State.currentDateIndex
              loopCount:
                exp: State.datesCount
              outputs:
                loop:
                  actions:
                    - callData:
                        name: Call Data Action
                        timeout:
                          lit:
                            minutes: 1
                        category:
                          Web Services Data Actions (WFM-HR):
                            dataAction:
                              Calculate Balance To Date:
                                inputs:
                                  employeeId:
                                    exp: Flow.employeeId
                                  end:
                                    exp: GetAt(Flow.dates, State.currentDateIndex)
                                successOutputs:
                                  values.timeOffType:
                                    var: State.timeOffTypeIds
                                  values.name:
                                    noValue: true
                                  values.balance:
                                    var: State.timeOffBalances
                                  values.units:
                                    noValue: true
                                  values.end:
                                    noValue: true
                                failureOutputs:
                                  errorCode:
                                    var: State.errorCode
                                  status:
                                    var: State.errorStatus
                                  correlationId:
                                    noValue: true
                                  entityId:
                                    noValue: true
                                  entityName:
                                    noValue: true
                                  userMessage:
                                    noValue: true
                                  userParamsMessage:
                                    noValue: true
                                  userParams.key:
                                    noValue: true
                                  userParams.value:
                                    noValue: true
                                  details.errorCode:
                                    noValue: true
                                  details.fieldName:
                                    noValue: true
                                  details.entityId:
                                    noValue: true
                                  details.entityName:
                                    noValue: true
                        outputs:
                          success:
                            actions:
                              - updateData:
                                  name: Update Data
                                  statements:
                                    - string:
                                        variable: State.index
                                        value:
                                          exp: FindFirst(State.timeOffTypeIds, Flow.timeOffTypeId)
                                    - string:
                                        variable: State.timeOffBalance
                                        value:
                                          exp: GetAt(State.timeOffBalances, ToInt(State.index))
                                    - stringCollection:
                                        variable: Flow.result
                                        value:
                                          exp: AddItem(Flow.result, (GetAt(Flow.dates, State.currentDateIndex) + ";" + State.timeOffBalance))
                          failure:
                            actions:
                              - updateData:
                                  name: Update Data
                                  statements:
                                    - string:
                                        variable: State.error
                                        value:
                                          exp: "\"Something went wrong:\" + State.errorCode + \":\" + ToString(State.errorStatus)"
                                    - stringCollection:
                                        variable: Flow.result
                                        value:
                                          exp: AddItem(Flow.result, (GetAt(Flow.dates, State.currentDateIndex) + ";" + State.error))
          - endWorkflow:
              name: End Workflow
              exitReason:
                noValue: true
